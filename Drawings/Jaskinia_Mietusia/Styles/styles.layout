encoding utf-8

# Translation fixes
text pl "units m" "m"
text pl "point station:temporary" "punkt pomiarowy"
text pl "area water" "woda"
text pl "area sump" "syfon"

layout water-blue  # Make water look blue
  code metapost
    def a_water (expr p) =
      T:=identity;
      thfill p withcolor (0.62, 0.79, 0.90);  
    enddef;
  endcode
endlayout water-blue

layout sump-blue  # Make sump look blue
  code metapost
    def a_sump (expr p) =
      T:=identity;
      thfill p withcolor (0.30, 0.47, 0.65);
    enddef;
  endcode  
endlayout sump-blue

layout clean

  copy water-blue
  copy sump-blue
  
  language pl  

  # Colour of the passage
  colour map-fg [100 99 81]

  # Color of map background
  # colour map-bg [70 90 70]

  grid bottom
  grid-size 25 25 25 m

  # Legend options:
  legend on
  map-header 0 100 sw
  statistics topo-length off
  statistics explo-length off

  code tex-map
    %%% 
    % Bad fix missing ogonek command
    %%%       
    \newdimen\ogonekxoffset
    \newdimen\ogonekyoffset
    \ogonekxoffset=0.15em
    \ogonekyoffset=0.1em
    \def\ogonek{\raise \ogonekyoffset \hbox{\accent24{}}}
    \def\k#1{\hskip\ogonekxoffset\ogonek\hskip -0.48 em\hskip-\ogonekxoffset #1}

    \newtoks\license

    \cavename={Jaskinia Mi\k{e}tusia}
    \cavelengthtitle={d\l{}ugość} %fix "ł" char
    \cavedepthtitle={g\l{}\k{e}bokość}
    \topotitle={autorzy}
    \topoteam={_placeholder_}
    \def\authorslist{\par
    {\bf Speleoklub Warszawski:}
    {Jan Grzeszek},
    {Joanna Jurczyk},\par
    {Marcin Lewandowski},
    {Pawe\l{} Nowikowski},
    {Stanislaw Mielarczek},\par
    {Radost Waszkiewicz}}

    \license={CC BY-SA 4.0}

    \legendcontent={%
      \hsize=\legendwidth
      \black\the\legendtextcolor 
      
      \ifnortharrow
        \setbox\tmpboxa=\hbox{\northarrow}%
        \tmpdimen=\dimexpr(\wd\tmpboxa+10pt)%
        \vbox to 0pt{\line{\hfil\box\tmpboxa}\vss}%
      \fi

      \edef\tmp{\the\cavename} \ifx\tmp\empty \else
        \nointerlineskip
        \vskip\lineskip % this emulates the old behavior, where \lineskip was added
        % because only a small (default) \baselineskip value was applied to \the\cavename
        {\rightskip=\tmpdimen plus 10em\the\legendtextheadersize\the\cavename\par}\vskip1cm
      \fi

      \ifscalebar\scalebar\vskip1cm\fi

      {
        % \rightskip=0pt plus 3em\parskip=3bp
        % \edef\tmp{\the\comment} \ifx\tmp\empty \else
        % {\the\legendtextsize\the\comment\par}\medskip
        % \fi

        %\everypar{\hangindent=2em\hangafter=1}

        \edef\tmp{\the\cavelength} \ifx\tmp\empty \else
        {\the\legendtextsize\si\the\cavelengthtitle: \ss\the\cavelength\par}
        \fi

        \edef\tmp{\the\cavedepth} \ifx\tmp\empty \else
        {\the\legendtextsize\si\the\cavedepthtitle: \ss\the\cavedepth\par}
        \fi

        % \edef\tmp{\the\exploteam} \ifx\tmp\empty \else
        % {\the\legendtextsize\si\the\explotitle: \ss\the\exploteam\quad\si\the\explodate\par}
        % \fi

        % \edef\tmp{\the\topoteam} \ifx\tmp\empty \else
        % {\the\legendtextsize\si\the\topotitle: \ss\the\topoteam\quad\si\the\topodate\par}
        % \fi

        \edef\tmp{\the\topoteam} \ifx\tmp\empty \else
        {\the\legendtextsize\si\the\topotitle: \ss\authorslist\quad\si\the\topodate\par}
        \fi

        % \edef\tmp{\the\cartoteam} \ifx\tmp\empty \else
        % {\the\legendtextsize\si\the\cartotitle: \ss\the\cartoteam\quad\si\the\cartodate\par}
        % \fi

        % \edef\tmp{\the\copyrights} \ifx\tmp\empty \else
        % {\the\legendtextsize\ss\the\copyrights\par}
        % \fi

        \edef\tmp{\the\license} \ifx\tmp\empty \else
        {\vskip 1 em\the\legendtextsize\ss\the\license\par}
        \fi
      }
      \formattedlegend
      \black
    }
  endcode
  
endlayout

layout debug

  grid bottom
  grid-size 25 25 25 m

  colour map-fg [80 80 80]
  colour map-bg [70 90 70]

  debug all

endlayout
